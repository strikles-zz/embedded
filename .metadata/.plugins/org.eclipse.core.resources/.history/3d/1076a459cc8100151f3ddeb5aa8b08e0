/*
 ============================================================================
 Name        : client.c
 Author      : 
 Version     :
 Copyright   : Your copyright notice
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#include <time.h>
#include <unistd.h>

#include <netdb.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <sys/types.h>

#include "net.h"
#include "xml.h"

#include "sensors.h"
#include "client.h"

#ifdef TEST
#include "test.h"
#endif


int main(int argc,char **argv)
{
	srand(time(NULL));

	// generic declarations
    char sendline[MAX_MSG_LEN];
    char recvline[MAX_MSG_LEN];
    uint16_t error_status = 0;

    // linux - addr declarations
    int socket_desc = socket(AF_INET, SOCK_STREAM, 0);

    while(1)
    {
        // generate Measurements
        if((error_status = generateMeasurements()))
        {
        	continue;
        }

        // build request
        if((error_status = buildRequestXML(update, sendline)))
        {
        	continue;
        }

        // send
        if((error_status = writeSocket(socket_desc, sendline)) == -1)
        {
        	continue;
        }

    	// read
        if((error_status = readSocket(socket_desc, recvline)) == -1)
        {
        	continue;
        }

        close(sock_desc)

        // linux specific
        sleep(5);
    }
}
